<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>iPad 2 居中修正版</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html {
            width: 100%; height: 100%;
            background-color: #000000;
            font-family: Helvetica, Arial, sans-serif;
            overflow: hidden;
        }

        /* 頂部與底部佈局 */
        .top-section { position: absolute; top: 40px; left: 40px; }
        .bottom-section { position: absolute; bottom: 40px; left: 40px; right: 40px; }

        /* 中間時間容器：確保寬度撐滿並置中 */
        .middle-section { 
            position: absolute; 
            top: 50%; 
            left: 0; 
            width: 100%; 
            text-align: center;
            overflow: visible; /* 允許縮放後超出容器但不被切掉 */
            -webkit-transform: translateY(-50%);
            transform: translateY(-50%);
        }

        .date-display { font-size: 32px; color: #FFFF00; font-weight: bold; }
        
        /* 時間顯示本體 */
        .time-display { 
            font-size: 160px; 
            color: #FFFFFF; 
            font-weight: bold; 
            white-space: nowrap; 
            display: inline-block;
            margin: 0 auto;
            /* 修正 iPad 2 縮放偏移的關鍵 */
            -webkit-transform-origin: center center;
            transform-origin: center center;
        }

        .weather-display { font-size: 28px; color: #FFFF00; font-weight: bold; }

        .control-button {
            position: absolute; bottom: 0; right: 0;
            width: 30px; height: 30px; background: rgba(255,255,0,0.1);
            border: 1px solid rgba(255,255,0,0.3); border-radius: 15px;
        }

        .main-popup {
            position: absolute; bottom: 40px; right: 10px;
            background: rgba(10, 10, 10, 0.98); border: 2px solid #FFFF00;
            padding: 15px; display: none; z-index: 1000; width: 300px;
            max-height: 80%; overflow-y: scroll; -webkit-overflow-scrolling: touch;
        }
        .show { display: block; }
        .section-title { color: #FFFF00; font-size: 14px; margin: 10px 0 5px; text-align: center; border-top: 1px dotted #333; padding-top: 10px; }
        .btn { background: #333; color: #FFFF00; border: 1px solid #FFFF00; padding: 8px; margin: 2px; border-radius: 4px; font-size: 14px; }
        .btn-sm { width: 45px; font-weight: bold; }
        .color-row { text-align: center; margin-bottom: 5px; color: #fff; }
        .swatch { display: inline-block; width: 30px; height: 30px; margin: 3px; border: 1px solid #666; border-radius: 3px; }
    </style>
</head>
<body>

    <div class="top-section">
        <div id="dateDisplay" class="date-display">載入中...</div>
    </div>

    <div class="middle-section">
        <div id="timeDisplay" class="time-display">00:00:00</div>
    </div>

    <div class="bottom-section">
        <div id="weatherDisplay" class="weather-display">定位中...</div>
        <button id="controlBtn" class="control-button"></button>
    </div>

    <div id="mainPopup" class="main-popup">
        <button class="btn" style="width:100%" onclick="toggleFormat()">切換 12/24H 制</button>

        <div class="section-title">時間比例修正 (置中縮放)</div>
        <div class="color-row">
            寬度: <button class="btn btn-sm" onclick="adjTimeW(-0.05)">-</button>
            <span id="wLab">100%</span>
            <button class="btn btn-sm" onclick="adjTimeW(0.05)">+</button>
        </div>
        <div class="color-row">
            高度: <button class="btn btn-sm" onclick="adjTimeH(-0.1)">-</button>
            <span id="hLab">100%</span>
            <button class="btn btn-sm" onclick="adjTimeH(0.1)">+</button>
        </div>

        <div class="section-title">字體顏色設定</div>
        <div class="color-row">日期顏色</div>
        <div id="palette1" class="color-row"></div>
        <div class="color-row">時間顏色</div>
        <div id="palette2" class="color-row"></div>
        <div class="color-row">天氣顏色</div>
        <div id="palette3" class="color-row"></div>

        <button class="btn" style="width:100%; margin-top:20px; background:#400; color:#fff;" onclick="closeMenu()">儲存並關閉</button>
    </div>

    <script>
        var is12H = true;
        var scaleX = 1.0, scaleY = 1.0;
        var colors = ['#FF0000', '#FF7F00', '#FFFF00', '#00FF00', '#0000FF', '#FFFFFF', '#FF69B4', '#00CED1'];
        
        var tDiv = document.getElementById('timeDisplay');
        var dDiv = document.getElementById('dateDisplay');
        var wDiv = document.getElementById('weatherDisplay');
        var menu = document.getElementById('mainPopup');

        function initPalettes() {
            for(var i=1; i<=3; i++) {
                var container = document.getElementById('palette' + i);
                for(var j=0; j<colors.length; j++) {
                    var s = document.createElement('div');
                    s.className = 'swatch';
                    s.style.backgroundColor = colors[j];
                    (function(t, c){
                        s.onclick = function() {
                            if(t === 1) dDiv.style.color = c;
                            if(t === 2) tDiv.style.color = c;
                            if(t === 3) wDiv.style.color = c;
                        };
                    })(i, colors[j]);
                    container.appendChild(s);
                }
            }
        }

        function update() {
            var now = new Date();
            var days = ['週日', '週一', '週二', '週三', '週四', '週五', '週六'];
            dDiv.innerHTML = now.getFullYear() + '年' + (now.getMonth() + 1) + '月' + now.getDate() + '日 ' + days[now.getDay()];

            var h = now.getHours(), m = now.getMinutes(), s = now.getSeconds();
            var ampm = "";
            if (is12H) {
                ampm = h >= 12 ? "PM " : "AM ";
                h = h % 12; if (h === 0) h = 12;
            }
            if (h < 10) h = "0" + h;
            if (m < 10) m = "0" + m;
            if (s < 10) s = "0" + s;
            tDiv.innerHTML = ampm + h + ":" + m + ":" + s;
        }

        // 核心修正：僅縮放 Scale，位移交給外層容器控制
        function applyTransform() {
            var s = "scale(" + scaleX + "," + scaleY + ")";
            tDiv.style.webkitTransform = s;
            tDiv.style.transform = s;
            document.getElementById('wLab').innerHTML = Math.round(scaleX * 100) + '%';
            document.getElementById('hLab').innerHTML = Math.round(scaleY * 100) + '%';
        }

        function adjTimeW(v) { scaleX += v; applyTransform(); }
        function adjTimeH(v) { scaleY += v; applyTransform(); }
        function toggleFormat() { is12H = !is12H; update(); }
        
        function getWeather() {
            var url = 'https://api.openweathermap.org/data/2.5/weather?lat=25.0074129&lon=121.2685473&appid=5d13f280068f27e7b123c2b25149a95c&units=metric&lang=zh_tw';
            var xhr = new XMLHttpRequest();
            xhr.open('GET', url, true);
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var data = JSON.parse(xhr.responseText);
                    wDiv.innerHTML = '新興里 ' + Math.round(data.main.temp) + '°C ' + data.weather[0].description;
                }
            };
            xhr.send();
        }

        document.getElementById('controlBtn').onclick = function(e) {
            e.stopPropagation();
            menu.className = (menu.className === "main-popup") ? "main-popup show" : "main-popup";
        };

        function closeMenu() { menu.className = "main-popup"; }

        initPalettes();
        setInterval(update, 1000);
        update();
        getWeather();
        setInterval(getWeather, 600000);
    </script>
</body>
</html>
