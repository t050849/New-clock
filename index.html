<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>iPad 2 專用時鐘</title>
    <style>
        * { margin: 0; padding: 0; }
        body, html {
            width: 100%; height: 100%;
            background-color: #000000;
            color: #FFFFFF;
            font-family: Helvetica, Arial, sans-serif;
            overflow: hidden;
        }

        /* 使用絕對定位替代 Flexbox，確保 iOS 9 相容性 */
        .top-section {
            position: absolute;
            top: 40px; left: 40px;
            width: 100%;
        }

        .middle-section {
            position: absolute;
            top: 50%; left: 50%;
            width: 100%;
            text-align: center;
            /* 舊版 Safari 必須帶 -webkit- 前綴 */
            -webkit-transform: translate(-50%, -50%);
            transform: translate(-50%, -50%);
        }

        .bottom-section {
            position: absolute;
            bottom: 40px; left: 40px; right: 40px;
        }

        .date-display {
            font-size: 32px;
            color: #FFFF00;
            font-weight: bold;
        }

        .time-display {
            font-size: 140px; /* 稍微縮小防止 iPad 2 跑版 */
            color: #FFFFFF;
            font-weight: bold;
            white-space: nowrap;
            display: inline-block;
            -webkit-transform-origin: center center;
        }

        .weather-display {
            font-size: 28px;
            color: #FFFF00;
            font-weight: bold;
        }

        .control-button {
            position: absolute;
            bottom: 0; right: 0;
            width: 20px; height: 20px;
            background-color: #333;
            border-radius: 10px;
            border: none;
            opacity: 0.3;
        }

        /* 選單簡單化 */
        .main-popup {
            position: absolute;
            bottom: 50px; right: 20px;
            background: rgba(20, 20, 20, 0.95);
            border: 1px solid #FFFF00;
            padding: 15px;
            display: none;
            z-index: 999;
            width: 260px;
            color: #FFFF00;
        }

        .show { display: block; }
        .popup-section { margin-bottom: 10px; text-align: center; }
        .btn { 
            padding: 10px; background: #444; color: #fff; border: none; 
            margin: 2px; border-radius: 4px; font-size: 14px;
        }
    </style>
</head>
<body>

    <div class="top-section">
        <div id="dateDisplay" class="date-display">正在讀取日期...</div>
    </div>

    <div class="middle-section">
        <div id="timeDisplay" class="time-display">00:00:00</div>
    </div>

    <div class="bottom-section">
        <div id="weatherDisplay" class="weather-display">正在讀取天氣...</div>
        <button id="controlBtn" class="control-button"></button>
    </div>

    <div id="mainPopup" class="main-popup">
        <div class="popup-section">
            <p>時間格式</p>
            <button class="btn" onclick="toggleFormat()">切換 12/24H</button>
        </div>
        <div class="popup-section">
            <p>時間寬度 (W)</p>
            <button class="btn" onclick="adjustW(-0.05)">-</button>
            <button class="btn" onclick="adjustW(0.05)">+</button>
        </div>
        <div class="popup-section">
            <p>時間高度 (H)</p>
            <button class="btn" onclick="adjustH(-0.1)">-</button>
            <button class="btn" onclick="adjustH(0.1)">+</button>
        </div>
        <button class="btn" style="width:100%; background: #600;" onclick="closeMenu()">關閉選單</button>
    </div>

    <script>
        // 全部使用 var 以相容舊版瀏覽器
        var is12H = true;
        var scaleX = 1.0;
        var scaleY = 1.0;
        var lat = 25.0074129;
        var lon = 121.2685473;
        var apiKey = '5d13f280068f27e7b123c2b25149a95c';

        var tDiv = document.getElementById('timeDisplay');
        var dDiv = document.getElementById('dateDisplay');
        var wDiv = document.getElementById('weatherDisplay');
        var menu = document.getElementById('mainPopup');

        function update() {
            var now = new Date();
            var days = ['週日', '週一', '週二', '週三', '週四', '週五', '週六'];
            
            // 日期
            dDiv.innerHTML = now.getFullYear() + '年' + (now.getMonth() + 1) + '月' + now.getDate() + '日 ' + days[now.getDay()];

            // 時間
            var h = now.getHours();
            var m = now.getMinutes();
            var s = now.getSeconds();
            var ampm = "";

            if (is12H) {
                ampm = h >= 12 ? "PM " : "AM ";
                h = h % 12;
                if (h === 0) h = 12;
            }

            if (h < 10) h = "0" + h;
            if (m < 10) m = "0" + m;
            if (s < 10) s = "0" + s;

            tDiv.innerHTML = ampm + h + ":" + m + ":" + s;
        }

        function getWeather() {
            var url = 'https://api.openweathermap.org/data/2.5/weather?lat=' + lat + '&lon=' + lon + '&appid=' + apiKey + '&units=metric&lang=zh_tw';
            var xhr = new XMLHttpRequest();
            xhr.open('GET', url, true);
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var data = JSON.parse(xhr.responseText);
                    wDiv.innerHTML = '新興里 ' + Math.round(data.main.temp) + '°C ' + data.weather[0].description;
                }
            };
            xhr.send();
        }

        // 縮放功能相容語法
        function applyTransform() {
            var style = "translate(-50%, -50%) scale(" + scaleX + "," + scaleY + ")";
            tDiv.style.webkitTransform = style;
            tDiv.style.transform = style;
        }

        function adjustW(v) { scaleX += v; applyTransform(); }
        function adjustH(v) { scaleY += v; applyTransform(); }
        function toggleFormat() { is12H = !is12H; update(); }
        function closeMenu() { menu.className = "main-popup"; }

        document.getElementById('controlBtn').onclick = function() {
            menu.className = "main-popup show";
        };

        // 啟動
        setInterval(update, 1000);
        update();
        getWeather();
        setInterval(getWeather, 600000);
    </script>
</body>
</html>
